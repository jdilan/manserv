<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MANSERV Local Test UI - Unit 1</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üè¶ MANSERV Local Test UI</h1>
            <p>Unit 1: Loan Account Management - API Testing Interface</p>
            <div class="api-status">
                <span id="apiStatus">Checking API...</span>
                <button onclick="checkApiHealth()">Refresh Status</button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab-button active" onclick="showTab('search')">üîç Search</button>
            <button class="tab-button" onclick="showTab('create')">‚ûï Create</button>
            <button class="tab-button" onclick="showTab('view')">üëÅÔ∏è View</button>
            <button class="tab-button" onclick="showTab('update')">‚úèÔ∏è Update</button>
            <button class="tab-button" onclick="showTab('delete')">üóëÔ∏è Delete</button>
            <button class="tab-button" onclick="showTab('reference')">üìö Reference Data</button>
        </nav>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content active">
            <h2>Search Accounts</h2>
            <form id="searchForm" onsubmit="searchAccounts(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Reference Number:</label>
                        <input type="text" id="search_refNo" placeholder="LA-2025-0001">
                    </div>
                    <div class="form-group">
                        <label>Customer Name:</label>
                        <input type="text" id="search_customerName" placeholder="Juan Dela Cruz">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Center Code:</label>
                        <input type="text" id="search_centerCode" placeholder="01">
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="search_status">
                            <option value="">All</option>
                            <option value="Active">Active</option>
                            <option value="Closed">Closed</option>
                            <option value="Archived">Archived</option>
                            <option value="Deleted">Deleted</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Search</button>
                    <button type="button" onclick="clearSearch()">Clear</button>
                    <button type="button" onclick="getAllAccounts()">Get All</button>
                </div>
            </form>

            <div id="searchResults" class="results-container">
                <div id="searchResultsHeader" class="export-header" style="display: none;">
                    <div class="export-info">
                        <strong>Search Results</strong> - Click to export the current results to PDF
                    </div>
                    <button onclick="exportSearchResultsToPDF()" class="btn-export">
                        üìÑ Export to PDF
                    </button>
                </div>
                <div id="searchResultsContent"></div>
            </div>
        </div>

        <!-- Create Tab -->
        <div id="create-tab" class="tab-content">
            <h2>Create New Account</h2>
            <div class="form-actions" style="margin-bottom: 20px;">
                <button onclick="loadSampleData('create')">Load Sample Data</button>
                <button onclick="clearForm('createForm')">Clear Form</button>
            </div>
            <form id="createForm" onsubmit="createAccount(event)">
                <!-- General Information -->
                <fieldset>
                    <legend>General Information</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Reference Number: *</label>
                            <input type="text" id="create_refNo" required maxlength="17">
                        </div>
                        <div class="form-group">
                            <label>Previous Reference Number: *</label>
                            <input type="text" id="create_prevRefNo" required maxlength="17">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Customer Name: *</label>
                            <input type="text" id="create_customerName" required maxlength="40">
                        </div>
                        <div class="form-group">
                            <label>Long Name: *</label>
                            <input type="text" id="create_longName" required maxlength="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>CRIB ID Number:</label>
                            <input type="text" id="create_cribId" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label>NIDSS Account Number:</label>
                            <input type="text" id="create_nidss" maxlength="13">
                        </div>
                    </div>
                </fieldset>

                <!-- Account Identification -->
                <fieldset>
                    <legend>Account Identification</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Center Code: *</label>
                            <select id="create_centerCode" required></select>
                        </div>
                        <div class="form-group">
                            <label>Budget Unit: *</label>
                            <select id="create_budgetUnit" required></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Corporation: *</label>
                            <select id="create_corporation" required></select>
                        </div>
                        <div class="form-group">
                            <label>Book Code: *</label>
                            <select id="create_bookCode" required></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Economic Activity Code: *</label>
                        <select id="create_economicActivity" required></select>
                    </div>
                </fieldset>

                <!-- Loan Dates -->
                <fieldset>
                    <legend>Loan Dates</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Original Release Date: *</label>
                            <input type="date" id="create_originalReleaseDate" required>
                        </div>
                        <div class="form-group">
                            <label>Start of Term: *</label>
                            <input type="date" id="create_startOfTerm" required>
                        </div>
                        <div class="form-group">
                            <label>Maturity Date: *</label>
                            <input type="date" id="create_maturityDate" required>
                        </div>
                    </div>
                </fieldset>

                <!-- Account Type and Funding -->
                <fieldset>
                    <legend>Account Type and Funding</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Account Type: *</label>
                            <select id="create_accountType" required onchange="togglePurposeField('create')"></select>
                        </div>
                        <div class="form-group">
                            <label>Purpose:</label>
                            <input type="text" id="create_purpose" maxlength="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fund Source: *</label>
                            <select id="create_fundSource" required></select>
                        </div>
                        <div class="form-group">
                            <label>Lending Program: *</label>
                            <select id="create_lendingProgram" required></select>
                        </div>
                        <div class="form-group">
                            <label>Area: *</label>
                            <select id="create_area" required></select>
                        </div>
                    </div>
                </fieldset>

                <!-- Loan Classification -->
                <fieldset>
                    <legend>Loan Classification</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="create_isRestructured">
                                Is Restructured
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Type of Credit: *</label>
                            <input type="text" id="create_typeOfCredit" required value="CUR" maxlength="6">
                        </div>
                        <div class="form-group">
                            <label>Maturity Code: *</label>
                            <select id="create_maturityCode" required></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Purpose of Credit: *</label>
                            <input type="text" id="create_purposeOfCredit" required value="P" maxlength="1">
                        </div>
                        <div class="form-group">
                            <label>Number of Records:</label>
                            <input type="number" id="create_numberOfRecords" value="1">
                        </div>
                    </div>
                </fieldset>

                <!-- Guarantee and Litigation -->
                <fieldset>
                    <legend>Guarantee and Litigation</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="create_isGuaranteed" onchange="toggleGuaranteedBy('create')">
                                Is Guaranteed
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Guaranteed By:</label>
                            <select id="create_guaranteedBy" disabled></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="create_isUnderLitigation" onchange="toggleLitigationDate('create')">
                                Is Under Litigation
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Litigation Date:</label>
                            <input type="date" id="create_litigationDate" disabled>
                        </div>
                    </div>
                </fieldset>

                <!-- Loan Status and Currency -->
                <fieldset>
                    <legend>Loan Status and Currency</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Loan Status: *</label>
                            <select id="create_loanStatus" required>
                                <option value="CUR">CUR - Current</option>
                                <option value="PDO">PDO - Past Due</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Loan Project Type: *</label>
                            <select id="create_loanProjectType" required>
                                <option value="C">C - Commercial</option>
                                <option value="D">D - Developmental</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Currency: *</label>
                            <select id="create_currency" required></select>
                        </div>
                    </div>
                </fieldset>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">Create Account</button>
                    <button type="button" onclick="clearForm('createForm')">Clear</button>
                </div>
            </form>
        </div>

        <!-- View Tab -->
        <div id="view-tab" class="tab-content">
            <h2>View Account</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Account ID or Reference Number:</label>
                    <input type="text" id="view_identifier" placeholder="1 or LA-2025-0001">
                </div>
                <button onclick="viewAccount()">View</button>
            </div>
            <div id="viewResults" class="results-container"></div>
        </div>

        <!-- Update Tab -->
        <div id="update-tab" class="tab-content">
            <h2>‚úèÔ∏è Update Loan Account</h2>
            <p>Search for an account to update, then modify the Customer Name, Long Name, and Guarantee/Litigation information.</p>

            <!-- Load Account Section -->
            <fieldset class="search-section">
                <legend>üîç Load Account</legend>
                <div class="form-row">
                    <div class="form-group">
                        <label>Reference Number:</label>
                        <input type="text" id="update_searchRefNo" placeholder="e.g., LA-2025-0001">
                    </div>
                    <div class="form-group" style="text-align: center; align-self: center;">
                        <strong>OR</strong>
                    </div>
                    <div class="form-group">
                        <label>Account ID:</label>
                        <input type="number" id="update_searchAccountId" placeholder="e.g., 1">
                    </div>
                </div>
                <div class="form-actions">
                    <button onclick="loadAccountForUpdate()" class="btn-primary">üîç Load Account</button>
                    <button onclick="clearUpdateSearch()">üóëÔ∏è Clear</button>
                </div>
            </fieldset>

            <!-- Account Information Panel (Initially Hidden) -->
            <div id="updateFormContainer" style="display: none;">
                <!-- General Information Section -->
                <fieldset class="editable-section">
                    <legend>General Information (Customer Name and Long Name are editable)</legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Reference Number (Cannot be changed):</label>
                            <input type="text" id="update_refNo" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Previous Reference Number (Read-only):</label>
                            <input type="text" id="update_prevRefNo" readonly class="readonly-field">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Customer Name: *</label>
                            <input type="text" id="update_customerName" maxlength="40" required>
                        </div>
                        <div class="form-group">
                            <label>Long Name: *</label>
                            <input type="text" id="update_longName" maxlength="100" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>CRIB ID Number (Read-only):</label>
                            <input type="text" id="update_cribId" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>NIDSS Account Number (Read-only):</label>
                            <input type="text" id="update_nidss" readonly class="readonly-field">
                        </div>
                    </div>
                </fieldset>

                <!-- Account Identification Section (Read-only) -->
                <fieldset class="readonly-section">
                    <legend>Account Identification (Read-only)</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Center Code:</label>
                            <input type="text" id="update_centerCode" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Budget Unit:</label>
                            <input type="text" id="update_budgetUnit" readonly class="readonly-field">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Corporation:</label>
                            <input type="text" id="update_corporation" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Book Code:</label>
                            <input type="text" id="update_bookCode" readonly class="readonly-field">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Economic Activity Code:</label>
                        <input type="text" id="update_economicActivity" readonly class="readonly-field">
                    </div>
                </fieldset>

                <!-- Loan Dates Section (Read-only) -->
                <fieldset class="readonly-section">
                    <legend>Loan Dates (Read-only)</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Original Release Date:</label>
                            <input type="date" id="update_originalReleaseDate" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Maturity Date:</label>
                            <input type="date" id="update_maturityDate" readonly class="readonly-field">
                        </div>
                    </div>
                </fieldset>

                <!-- Account Type and Funding Section (Read-only) -->
                <fieldset class="readonly-section">
                    <legend>Account Type and Funding (Read-only)</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Account Type:</label>
                            <input type="text" id="update_accountType" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Fund Source:</label>
                            <input type="text" id="update_fundSource" readonly class="readonly-field">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Lending Program:</label>
                            <input type="text" id="update_lendingProgram" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label>Currency:</label>
                            <input type="text" id="update_currency" readonly class="readonly-field">
                        </div>
                    </div>
                </fieldset>

                <!-- Guarantee and Litigation Section (Editable) -->
                <fieldset class="editable-section">
                    <legend>Guarantee and Litigation Information (Editable)</legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="update_isGuaranteed" onchange="toggleGuaranteedBy('update')">
                                Is Guaranteed
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Guaranteed By:</label>
                            <input type="text" id="update_guaranteedBy" maxlength="100" placeholder="Enter guarantor name">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="update_isUnderLitigation" onchange="toggleLitigationDate('update')">
                                Is Under Litigation
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Litigation Date:</label>
                            <input type="date" id="update_litigationDate">
                        </div>
                    </div>
                </fieldset>

                <!-- Update Actions -->
                <div class="form-actions">
                    <button onclick="updateAccount()" class="btn-primary">üíæ Update Account</button>
                    <button onclick="cancelUpdate()">‚ùå Cancel</button>
                </div>
            </div>
        </div>

        <!-- Delete Tab -->
        <div id="delete-tab" class="tab-content">
            <h2>Delete Account</h2>
            <p class="warning">‚ö†Ô∏è This will perform a soft delete (mark as deleted)</p>
            <div class="form-row">
                <div class="form-group">
                    <label>Account ID:</label>
                    <input type="number" id="delete_accountId" placeholder="1">
                </div>
                <button onclick="deleteAccount()" class="btn-danger">Delete</button>
            </div>
            <div id="deleteResults" class="results-container"></div>
        </div>

        <!-- Reference Data Tab -->
        <div id="reference-tab" class="tab-content">
            <h2>Reference Data</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Select Data Type:</label>
                    <select id="refDataType" onchange="loadReferenceData()">
                        <option value="">-- Select --</option>
                        <option value="CORPORATION">Corporations</option>
                        <option value="BOOKCODE">Book Codes</option>
                        <option value="FUNDSOURCE">Fund Sources</option>
                        <option value="LENDINGPROGRAM">Lending Programs</option>
                        <option value="AREA">Areas</option>
                        <option value="MATURITYCODE">Maturity Codes</option>
                        <option value="GUARANTEEDBY">Guaranteed By</option>
                        <option value="CURRENCY">Currencies</option>
                        <option value="account-types">Account Types</option>
                        <option value="economic-activities">Economic Activities</option>
                        <option value="centers">Centers</option>
                        <option value="customers">Customers</option>
                    </select>
                </div>
            </div>
            <div id="refDataResults" class="results-container">
                <div id="refDataResultsHeader" class="export-header" style="display: none;">
                    <div class="export-info">
                        <strong>Reference Data</strong> - Click to export the current data to PDF
                    </div>
                    <button onclick="exportReferenceDataToPDF()" class="btn-export">
                        üìÑ Export to PDF
                    </button>
                </div>
                <div id="refDataResultsContent"></div>
            </div>
        </div>

        <!-- Response Viewer -->
        <div id="responseViewer" class="response-viewer">
            <h3>API Response</h3>
            <div class="response-header">
                <span id="responseStatus"></span>
                <button onclick="copyResponse()">Copy</button>
                <button onclick="clearResponse()">Clear</button>
            </div>
            <pre id="responseBody"></pre>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/sample-data.js"></script>
    <script src="js/response-viewer.js"></script>
    <script>
        // Initialize on page load
        window.onload = function() {
            checkApiHealth();
            loadDropdowns();
        };
    </script>
</body>
</html>
